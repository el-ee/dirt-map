<!DOCTYPE html>
<meta charset="utf-8">

<head>
	<script src="js_lib/colors.js"></script>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<link href="style/cluster_style.css" media="all" rel="stylesheet" type="text/css" />
	<link href='http://fonts.googleapis.com/css?family=Quantico' rel='stylesheet' type='text/css'>
</head>
<body>


	<div id="graph"></div>
	<div id="legend"></div>
	<div id="description"></div>
	
<script>

var color_dict = clusters_bright;
drawLegend(color_dict);

var file_name = "json/network-site-order/network-site-order_S13_S14_S15_S16.json";

d3.select("#description").append("h2")
	.text("File: " + file_name);
	
d3.select("#description").append("p")
	.text("Each colored circle represents a particular order of bacteria. Colors are coded at the Phylum level. White circles represent different samples. Lines connect order of bacteria to the samples in which they were found.")

var width = 1024,
    height = 768;

//var color = d3.scale.category20();

var force = d3.layout.force()
    .linkDistance(10)
    .linkStrength(2)
    .size([width, height]);

var svg = d3.select("#graph").append("svg")
    .attr("width", width)
    .attr("height", height);

d3.json(file_name, function(error, graph) {
  var nodes = graph.nodes.slice(),
      links = [],
      bilinks = [];

  graph.links.forEach(function(link) {
    var s = nodes[link.source],
        t = nodes[link.target],
        i = {}; // intermediate node
    nodes.push(i);
    links.push({source: s, target: i}, {source: i, target: t});
    bilinks.push([s, i, t]);
  });

  force
      .nodes(nodes)
      .links(links)
      .start();

  var link = svg.selectAll(".link")
      .data(bilinks)
    .enter().append("path")
      .attr("class", "link");

  var node = svg.selectAll(".node")
      .data(graph.nodes)
    .enter().append("g")
	  .attr("class", "node")
      .call(force.drag);

   node.append("circle")        
	 	.attr("r", function(d){if (d.group == "Sample") {return 15;} else {return 5;}})
	  .style("fill", function(d) { 
			if (d.group == "Sample") {return "#ffffff"; }
	  	  else if (typeof color_dict[d.group] == "undefined") { return color_dict["Other"]; }
	  	  else { return color_dict[d.group]; }
	    });
  
	node.append("title")
      .text(function(d) { return d.name; });
	  
	node.append("text")
        .attr("text-anchor", function(d){if (d.group=="Sample") {return "middle";} else {return "left";}})
				.attr("dy", ".4em")
				.attr("dx", function(d){if (d.group=="Sample") {return "0"} else {return ".4em"}})
        .text(function(d){return d.name})
				.attr("visibility", function(d){if (d.group == "Sample") {return "visible";} else {return "hidden";}})
				
	node.on("mouseover", function(d){d3.select(this).select("text").attr("visibility", "visible");})
				.on("mouseout", function(d){if(d.group != "Sample") {d3.select(this).select("text").attr("visibility", "hidden");}});
	

  force.on("tick", function() {
    link.attr("d", function(d) {
      return "M" + d[0].x + "," + d[0].y
          + "S" + d[1].x + "," + d[1].y
          + " " + d[2].x + "," + d[2].y;
    });
    node.attr("transform", function(d) {
      return "translate(" + d.x + "," + d.y + ")";
    });
  });
});

</script>
</body>
</html>