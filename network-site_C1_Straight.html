<!-- This file is a modified version of Mike Bostock's example: http://bl.ocks.org/mbostock/4600693 -->

<!DOCTYPE html>
<meta charset="utf-8">

<head>
	<script src="js_lib/colors.js"></script>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<link href="style/cluster_style.css" media="all" rel="stylesheet" type="text/css" />
	<link href='http://fonts.googleapis.com/css?family=Quantico' rel='stylesheet' type='text/css'>
</head>
<body>


	<div id="graph"></div>
	<div id="legend"></div>
	<div id="description"></div>
	
<script>

drawLegend(clusters_dict);

var file_name = "json/network-by-site/order-network_S1_S2_S3.json";

d3.select("#description").append("h2")
	.text("File: " + file_name);
	
d3.select("#description").append("p")
	.text("Each colored circle represents a particular order of bacteria. Colors are coded at the Phylum level. White circles represent different samples. Lines connect order of bacteria to the samples in which they were found.")

var width = 1024,
    height = 768;

//var color = d3.scale.category20();

var force = d3.layout.force()
		.charge(-100)
    .linkDistance(40)
    .size([width, height]);

var svg = d3.select("#graph").append("svg")
    .attr("width", width)
    .attr("height", height);

d3.json(file_name, function(error, graph) {
  force
      .nodes(graph.nodes)
      .links(graph.links)
      .start();

  var link = svg.selectAll(".link")
      .data(graph.links)
    .enter().append("line")
			.attr("class", "link")
    	.style("stroke-width", 1);

  var node = svg.selectAll(".node")
      .data(graph.nodes)
    .enter().append("g")
	  .attr("class", "node")
      .call(force.drag);

   node.append("circle")        
	 	.attr("r", function(d){if (d.group == "Sample") {return 15;} else {return 5;}})
	  .style("fill", function(d) { 
			if (d.group == "Sample") {return "#ffffff"; }
	  	  else if (typeof clusters_dict[d.group] == "undefined") { return clusters_dict["Other"]; }
	  	  else { return clusters_dict[d.group]; }
	    });
  
	node.append("title")
      .text(function(d) { return d.name; });
	  
	node.append("text")
        .attr("text-anchor", function(d){if (d.group=="Sample") {return "middle";} else {return "left";}})
				.attr("dy", ".4em")
				.attr("dx", function(d){if (d.group=="Sample") {return "0"} else {return ".4em"}})
        .text(function(d){return d.name})
				.attr("visibility", function(d){if (d.group == "Sample") {return "visible";} else {return "hidden";}})
				
	node.on("mouseover", function(d){d3.select(this).select("text").attr("visibility", "visible");})
				.on("mouseout", function(d){if(d.group != "Sample") {d3.select(this).select("text").attr("visibility", "hidden");}});
	

  force.on("tick", function() {
		link.attr("x1", function(d) { return d.source.x; })
		        .attr("y1", function(d) { return d.source.y; })
		        .attr("x2", function(d) { return d.target.x; })
		        .attr("y2", function(d) { return d.target.y; });
				    node.attr("transform", function(d) {
				      return "translate(" + d.x + "," + d.y + ")";
				    });
  });
});

</script>
</body>
</html>